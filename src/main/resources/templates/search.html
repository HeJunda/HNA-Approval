<!DOCTYPE html>
<html lang="en"></html>
<html lang="en" xmnls="www.thymeleaf.org" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"></meta>
    <meta name="format-detection" content="telephone=no"></meta>
    <meta name="apple-mobile-web-app-capable" content="yes"></meta>
	<title>渤海信托</title>
	<link rel="stylesheet" type="text/css" href="/css/index.css" />
	<link rel="stylesheet" type="text/css" href="/css/dropload.css"></link>
</head>
<body>
	<div id="app">
		<header class="header cleanF">
	        <a href="index.html"><span class="back"></span></a>
	        <h3 class="approve">流程查询</h3>   
	    </header>
		<div class="container paddinTop">
		  <div class="follow-tab">
             <ul class="cleanF">
                <router-link tag="li" to="active">本人呈报</router-link>
                <router-link tag="li" to="person">本人审批</router-link>
              </ul>
		  </div>	      
		  
		  <router-view></router-view>
	      
		</div>
	</div>
	<script type="text/javascript" src="js/lib/vue.min.js"></script>
	<script type="text/javascript" src="js/lib/axios.min.js"></script>
	<script type="text/javascript" src="js/lib/vue-router.min.js"></script>
	<script type="text/javascript" src="js/lib/jquery.js"></script>
	<script	type="text/javascript" src="js/lib/cookies.js"></script>
	<script type="text/javascript" src="js/lib/layer.js"></script>
	<script type="text/javascript" src="js/lib/dropload.js"></script>
	<script> 
	var actives={
			 template:`<div class="agency-list" id="active">
				<div class="item-active">
					<div class="search">
					    <div class="search-box">
					        <input type="text" placeholder="请输入项目名称" id="gulpwork" v-model="name"/><span class="search-btn fr" v-on:click='sears()'><i class="search-icon"></i>搜索</span>
					    </div>
					</div>
			
				   	<ul>
				      <li class="clearfix" v-for="(item,index) in datae">
				      	<a v-bind:href="getHref(index)">
				      		<div class="agency-right">
				            <div class="right-box">
				           		<h3 class="agency-title">{{item.flowname}}</h3>
				           		<p class="follow-person">发起人：<span class="fr">{{item.startername}}</span></p>
				           		<p class="follow-person">发起时间：<span class="fr">{{item.starttime}}</span></p>
				           		<p class="follow-person">当前审批人：<span class="fr">{{item.assigneename}}</span></p>
				           		<p class="follow-person">当前审批部门：<span class="fr">{{item.startorg}}</span></p>
				           		<span class="prompt fr">{{item.flowstatus}}</span>
				           </div>
				           </div>
				      	</a>
				      </li>
				    </ul>
			    </div>		
			</div>`,
			data:function(){
				return{
					name:"",
					names:"",
					dataes:[]
				}
			},
			created:function(){
				  var _this=this;
				  var user=getCookie('userid')
				  var start=0;
				  $("#active").dropload({
					scrollArea : window,
					loadDownFn : function(me){
						if(_this.dataes.length>10){
							start=_this.dataes.length;
						}
						axios.get("/workflow/getMyInitiatedProcess",{params:{userid:user,start:start,limit:10}}).then(function(response){
							if(response.data.length!=_this.dataes.length||response.data.length>10){
								_this.dataes=_this.dataes.concat(response.data)
							 	}else if(response.data.length==0){
				                	me.lock();
				                   	me.noData();
								}
								setTimeout(function(){
				                    me.resetload();
				                },1000);
						}).catch(function(error){
						 	console.log(error);
							me.resetload();
						});
					}
				})
			},
			methods:{
				getHref:function(data){
		               return '/searchDetail.html?index='+data;
		        },
				sears:function(){
					var gulpwork=$("#gulpwork").val();
					console.log(gulpwork)
					if(gulpwork==""){
						alert("查询内容不能为空");
					}else{
						 this.names=this.name
			        }
				}
			},
			computed:{
			    datae:function(){
			    	var name = this.names;
			        if (name) {
			            return this.dataes.filter(function(product) {
			                return Object.keys(product).some(function(key) {
			                    return String(product[key]).toLowerCase().indexOf(name) > -1
			                })
			            })
			        }
			        return this.dataes;
			    }
			}
		  }
	var persons={
			 template:`<div class="agency-list" id="active">
					<div class="item-active">
						<div class="search">
						    <div class="search-box">
						        <input type="text" placeholder="请输入项目名称" id="gulpwork" v-model="name"/><span class="search-btn fr" v-on:click='sears()'><i class="search-icon"></i>搜索</span>
						    </div>
						</div>
	
					   	<ul>
					      <li class="clearfix" v-for="(item,index) in datae">
					      <a v-bind:href="getHref(index)">
					         <div class="agency-right">
					            <div class="right-box">
					           <h3 class="agency-title">{{item.flowname}}</h3>
					           <p class="follow-person">发起人：<span class="fr">{{item.startername}}</span></p>
					           <p class="follow-person">发起时间：<span class="fr">{{item.starttime}}</span></p>
					           <p class="follow-person">当前审批人：<span class="fr">{{item.assigneename}}</span></p>
					           <p class="follow-person">当前审批部门：<span class="fr">{{item.startorg}}</span></p>
					           <span class="prompt fr">{{item.flowstatus}}</span>
					           </div>
					         </div>
					      </a>
					      </li>
					    </ul>
				    </div>		
				</div>`,
				data:function(){
					return{
						name:"",
						names:"",
						dataes:[]
					}
				},
				created:function(){
					  var _this=this;
					  var user=getCookie('userid')
					  var start = 0
					  $("#active").dropload({
						scrollArea : window,
						loadDownFn : function(me){
							if(_this.dataes.length>10){
								start=_this.dataes.length;
							}
							axios.get("/workflow/getMyInitiatedProcess",{params:{userid:user,start:start,limit:10}}).then(function(response){
								if(response.data.length>10||response.data.length!=_this.dataes.length){
									_this.dataes=_this.dataes.concat(response.data)
								 	}else{
					                	me.lock();
					                   	me.noData();
									}
									setTimeout(function(){
					                    me.resetload();
					                },1000);
							}).catch(function(error){
							 	console.log(error);
								me.resetload();
							});
						}
					})
				},
				methods:{
					getHref:function(data){
			               return '/searchDetail.html?index='+data;
			        },
					sears:function(){
						var gulpwork=$("#gulpwork").val();
						console.log(gulpwork)
						if(gulpwork==""){
							alert("查询内容不能为空");
						}else{
							 this.names=this.name
				        }
					}
				},
				computed:{
	                datae:function(){
	                	var name = this.names;
	                    if (name) {
	                        return this.dataes.filter(function(product) {
	                            return Object.keys(product).some(function(key) {
	                                return String(product[key]).toLowerCase().indexOf(name) > -1
	                            })
	                        })
	                    }
	                    return this.dataes;
	                }
	            }
		  }
		  const routers = [
		    {
		      path:"",
		      redirect:'/active'
		    },
		    {
		      path:"/active",
		      component:actives
		    },
		    {
		      path:"/person",
		      component:persons
		    }
		  ]

		  const routeres = new VueRouter({
		      routes: routers
		    })

		  new Vue({
		    router:routeres
		  }).$mount("#app")
	</script>
</body>
	
</html>