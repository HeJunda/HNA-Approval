<!DOCTYPE html>
<html lang="en"></html>
<html lang="en" xmnls="www.thymeleaf.org" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"></meta>
    <meta name="format-detection" content="telephone=no"></meta>
    <meta name="apple-mobile-web-app-capable" content="yes"></meta>
	<title>渤海信托</title>
	<link rel="stylesheet" type="text/css" href="/css/index.css"></link>
	<link rel="stylesheet" type="text/css" href="/css/dropload.css"></link>
</head>
<body>
	<div id="app">
		<header class="header cleanF">
	        <a href="index.html"><span class="back"></span></a>
	        <h3 class="approve">项目查询</h3>   
	    </header>
		<div class="container paddinTop">
        <div class="project-tab">
              <ul class="cleanF">
                <router-link tag="li" to="active">本人名下</router-link>
                <router-link tag="li" to="project">本部门下</router-link>
              </ul>
        </div>
        
        <router-view></router-view>
        
		</div>
	</div>
	<script type="text/javascript" src="js/lib/vue.min.js"></script>
  	<script type="text/javascript" src="js/lib/vue-router.min.js"></script>
  	<script type="text/javascript" src="js/lib/axios.min.js"></script>
  	<script	type="text/javascript" src="js/lib/cookies.js"></script>
	<script type="text/javascript" src="js/lib/layer.js"></script>
	<script type="text/javascript" src="js/lib/jquery.js"></script>
	<script type="text/javascript" src="js/lib/dropload.js"></script>
  <script type="text/javascript">
  var active={
    template:`<div class="active">
  				<div class="item-active">
	                <div class="search">
	                    <div class="search-box">
	                        <input type="text" placeholder="请输入项目名称" id="itemword"/><span class="search-btn fr" v-on:click="sear()"><i class="search-icon"></i>搜索</span>
	                    </div>
	                </div>
	                <div class="agency-list">
	                   <ul>
	                      <li class="clearfix" v-for="item in dataes">
	                        <a v-bind:href="getTitleHref(item.projectcode)">
	                         <div class="agency-left">
	                             <div class="lucre-name">
	                              <p class="project-price">{{item.predictmaxyield}}%</p>
	                              <p class="project-lucre">预计收益</p>
	                             </div>
	                         </div>
	                         <div class="list-right">
	                          <div class="right-box">
	                           <h3 class="agency-title">{{item.dptname}}</h3>
	                           <p>{{item.projectname}}</p>
	                           </div>
	                         </div>
	                         </a>
	                      </li>
	                      
	                   </ul>
	                </div>
                </div>
              </div>`,
			  data:function(){
					return{
						dataes:[]
					}
			  },
			  created:function(){
					var _this=this;
					var user=getCookie('userid')
					$("#active").dropload({
						scrollArea : window,
						loadDownFn : function(me){
							start=0;
							var result = '';
							axios.get("/project/getProjectList",{params:{userid:user,start:start++,limit:10}}).then(function(response){
								_this.dataes=response.data
								if(_this.dataes.length>0){
								 	}else{
					                	me.lock();
					                   	me.noData();
									}
									setTimeout(function(){
					                    $('.item-active').append(result);
					                    me.resetload();
					                },1000);
							}).catch(function(error){
							 	console.log(error);
								me.resetload();
							});
						}
					})
			  },
			  methods:{
				  getTitleHref:function(data){
		               return '/project-detail.html?projectcode='+data;
		          },
				  sear:function(){
					  var itemword=$("#itemword").val();
						if(itemword==""){
							alert("查询内容不能为空");
						}else{
							var _this=this;
							var user=getCookie('userid')
							axios.get("/project/getProjectList",{params:{userid:user,start:0,projectname:itemword}}).then(function(response){
								
								_this.dataes=response.data
							}).catch(function(error){
								console.log(error);
							});	
						}
				  }
			  }
  }
  var project={
    template:`<div id="project">
  				<div class="item-project">
					<div class="search">
					    <div class="search-box">
					        <input type="text" placeholder="请输入项目名称" id="gulpwork"/><span class="search-btn fr" v-on:click='sears()'><i class="search-icon"></i>搜索</span>
					    </div>
					</div>
					<div class="agency-list">
					   <ul>
					      <li class="clearfix" v-for="item in dataes">
					        <a v-bind:href="getTitleHref(item.projectcode)">
					         <div class="agency-left">
					             <div class="lucre-name">
					              <p class="project-price">{{item.predictmaxyield}}%</p>
					              <p class="project-lucre">预计收益</p>
					             </div>
					         </div>
					         <div class="list-right">
					          <div class="right-box">
					           <h3 class="agency-title">{{item.dptname}}</h3>
					           <p>{{item.projectname}}</p>
					           </div>
					         </div>
					         </a>
					      </li>
					   </ul>
					</div>
				</div>
			</div>`,
			  data:function(){
					return{
						dataes:[]
					}
			  },
			  created:function(){
					var _this=this;
					var user=getCookie('userid')
	      			$("#project").dropload({
						scrollArea : window,
						loadDownFn : function(me){
							start=0;
							var result = '';
							axios.get("/project/getMyDeptProjectList",{params:{userid:user,start:start++,limit:10}}).then(function(response){
								_this.dataes=response.data
								if(_this.dataes.length>0){
								 	}else{
					                	me.lock();
					                   	me.noData();
									}
									setTimeout(function(){
					                    $('.item-project').append(result);
					                    me.resetload();
					                },1000);
							}).catch(function(error){
							 	console.log(error);
								me.resetload();
							});
						}
					})
			  },
			  methods:{
				  getTitleHref:function(data){
		               return '/project-detail.html?projectcode='+data;
		          },
				  sears:function(){
					  var gulpwork=$("#gulpwork").val();
						console.log(gulpwork)
						if(gulpwork==""){
							alert("查询内容不能为空");
						}else{
							var _this=this;
							var user=getCookie('userid')
							axios.get("/project/getMyDeptProjectList",{params:{userid:user,start:0,projectname:gulpwork}}).then(function(response){
								_this.dataes=response.data
							}).catch(function(error){
								console.log(error);
							});	
						}
				  }
			  }
  }
  const routers=[
    {
      path:"",
      redirect:'/active'
    },
    {
      path:"/active",
      component:active
    },
    {
      path:"/project",
      component:project
    }
  ]
  const routeres = new VueRouter({
      routes: routers
    })

  new Vue({
    router:routeres
  }).$mount("#app")
  </script>
</body>
</html>