<!DOCTYPE html>
<html lang="en"></html>
<html lang="en" xmnls="www.thymeleaf.org" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"></meta>
    <meta name="format-detection" content="telephone=no"></meta>
    <meta name="apple-mobile-web-app-capable" content="yes"></meta>
	<title>渤海信托</title>
	<link rel="stylesheet" type="text/css" href="/css/index.css" />
	<link rel="stylesheet" type="text/css" href="/css/dropload.css"></link>
</head>
<body>
	<div id="app">
		<header class="header cleanF">
	        <a href="index.html"><span class="back"></span></a>
	        <h3 class="approve">待阅流程</h3>   
	    </header>
		<div class="container paddinTop">
		  <div class="follow-tab">
              <ul class="cleanF">
                <router-link tag="li" to="await">待阅</router-link>
                <router-link tag="li" to="already">已阅</router-link>
              </ul>
		  </div>	    
		  
		  <router-view></router-view>
		   
		</div>
	</div>
	<script type="text/javascript" src="js/lib/vue.min.js"></script>
  	<script type="text/javascript" src="js/lib/vue-router.min.js"></script>
  	<script type="text/javascript" src="js/lib/axios.min.js"></script>
  	<script type="text/javascript" src="js/lib/jquery.js"></script>
  	<script	type="text/javascript" src="js/lib/cookies.js"></script>
	<script type="text/javascript" src="js/lib/iscroll.js"></script>
  	<script type="text/javascript" src="js/lib/layer.js"></script>
  	<script type="text/javascript" src="js/lib/dropload.js"></script>
 	<script type="text/javascript">
 	var await={
 			template:`<div class="agency-list" id="await">
						<div class="item-await">
					   		<ul>
					      		<li class="clearfix" v-for="(item,index) in dataes">
					      		<a :href="getHref(item.taskid)">
					      			<div class="agency-right">
					            		<div class="right-box">
					            			
					           				<p class="follow-person">是否成功：<span class="fr">{{item.taskname}}</span></p>
					           				<p class="follow-person">发送人：<span class="fr">{{item.sendername}}</span></p>
					           				<p class="follow-person">创建时间：<span class="fr">{{item.createtime}}</span></p>
					           				<p class="follow-person">流程发起部门：<span class="fr">{{item.startorg}}</span></p>
					           				<p class="follow-person">流程发起人：<span class="fr">{{item.startname}}</span></p>
					           			</div>
					           		</div>
					           	</a>	
					      		</li>
					        </ul>
				    	</div>		
					</div>`,
					data:function(){
						return{
							dataes:[]	
						}
					},
					created:function(){
						$('.dropload-down').remove();
						var _this=this;
						var user=getCookie('userid')
						var start=0;
						$("#await").dropload({
							scrollArea : window,
							loadDownFn : function(me){
								if(_this.dataes.length>=10){
									start=_this.dataes.length;
								}
								axios.get("/workflow/getSplitRead",{params:{userid:user,start:start,limit:10,hasread:0}}).then(function(response){
									if(response.data.length>0){
										_this.dataes=_this.dataes.concat(response.data)
									 	}else{
						                	me.lock();
						                   	me.noData();
										}
										setTimeout(function(){
						                    me.resetload();
						                },1000);
								}).catch(function(error){
								 	console.log(error);
									me.resetload();
								});
							}
						})
					},
					methods:{
						getHref:function(data){
				               return '/followAwait.html?taskid='+data;
				        }
					}
 	}
 	var already={
 			template:`<div class="agency-list" id="already">
				<div class="item-already">
			   		<ul>
			      		<li class="clearfix" v-for="(item,index) in dataes">
			      		<a v-bind:href="getHref(item.instanceid)">
			      			<div class="agency-right">
			            		<div class="right-box">
			           				<p class="follow-person">是否成功：<span class="fr">{{item.taskname}}</span></p>
			           				<p class="follow-person">发送人：<span class="fr">{{item.sendername}}</span></p>
			           				<p class="follow-person">创建时间：<span class="fr">{{item.createtime}}</span></p>
			           				<p class="follow-person">流程发起部门：<span class="fr">{{item.startorg}}</span></p>
			           				<p class="follow-person">流程发起人：<span class="fr">{{item.startname}}</span></p>
			           				<p class="follow-person">知会处理人：<span class="fr">{{item.recivertime}}</span></p>
			           				<p class="follow-person">知会意见：<span class="fr">{{item.noticemsg}}</span></p>
			           			</div>
			           				
			           		</div>
			           	</a>	
			      		</li>
			        </ul>
				</div>		
			</div>`,
			data:function(){
				return{
					dataes:[]	
				}
			},
			created:function(){
				$('.dropload-down').remove();
				var _this=this;
				var user=getCookie('userid')
				var start=0;
				$("#already").dropload({
					scrollArea : window,
					loadDownFn : function(me){
						if(_this.dataes.length>=10){
							start=_this.dataes.length;
						}
						axios.get("/workflow/getSplitRead",{params:{userid:user,start:start,limit:10,hasread:1}}).then(function(response){
							if(response.data.length>0){
								_this.dataes=_this.dataes.concat(response.data)
							 	}else{
				                	me.lock();
				                   	me.noData();
								}
								setTimeout(function(){
				                    me.resetload();
				                },1000);
						}).catch(function(error){
						 	console.log(error);
							me.resetload();
						});
					}
				})
			},
			methods:{
				getHref:function(data){
		               return '/followAlready.html?instanceid='+data;
		        },
			}
 	}
 	
	const routers = [
		{
		    path:"",
		    redirect:'/await'
		},
		{
   		    path:"/await",
   		    component:await
		},
		{
			path:"/already",
   		    component: already
		}
	]

	const routeres = new VueRouter({
	      routes: routers
	    })

	new Vue({
	    router:routeres
	}).$mount("#app")
 	</script>
</body>
</html>


